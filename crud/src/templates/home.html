<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {%block title%}
    <title>Gestión de Empleados</title>
    {% endblock %}
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100 text-gray-900 min-h-screen">
    {% block navlink_content %}
    <nav
      id="simpleNavbar"
      class="fixed top-0 left-0 w-full z-50 bg-white border-b-4 border-gray-700 transition-transform duration-500 ease-in-out transform translate-y-0"
    >
      <div class="max-w-full mx-auto flex">
        <a
          href="{% url 'home' %}"
          class="flex-1 text-center rounded-xs bg-blue-700 hover:bg-blue-400 text-white px-4 py-2"
        >
          Empleados
        </a>
        <a
          href="{% url 'departamentos' %}"
          class="flex-1 text-center bg-blue-500 hover:bg-blue-400 text-white px-4 py-2"
        >
          Departamento
        </a>
      </div>
    </nav>
    {% endblock %}

    <div class="container mx-auto mt-6 px-4 py-8">
      {%block search %}
      <form
        method="get"
        class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 w-full"
      >
        <input
          type="text"
          name="nombre"
          value="{{ nombre }}"
          placeholder="Nombre"
          class="p-2 border border-gray-300 rounded w-full"
        />
        <input
          type="text"
          name="apellido"
          value="{{ apellido }}"
          placeholder="Apellido"
          class="p-2 border border-gray-300 rounded w-full"
        />

        <!--Botones del formulario-->
        <div class="md:col-span-2 text-center">
          <button
            type="submit"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
          >
            <span class="shiny-text"> Buscar</span>
          </button>
          <button
            type="button"
            onclick="window.location.href='.'"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
          >
            <span class="shiny-text"> Volver a cargar todos</span>
          </button>
        </div>
      </form>
      {% endblock %} {% block departament %}
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Lista de Empleados</h1>
        <button
          onclick="openModal('modal-create')"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
        >
          Crear empleado
        </button>
      </div>

      <!-- Tabla -->
      <div class="overflow-x-auto bg-white rounded shadow">
        <table class="min-w-full text-sm text-left">
          <thead class="bg-gray-200 text-gray-700">
            <tr>
              <th class="py-3 px-4">Nombre</th>
              <th class="py-3 px-4">Apellido</th>
              <th class="py-3 px-4">Salario</th>
              <th class="py-3 px-4">Email</th>
              <th class="py-3 px-4">Puesto</th>
              <th class="py-3 px-4">Departamento</th>
              <th class="py-3 px-4 text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for empleado in empleados %}
            <tr class="border-t border-gray-200 hover:bg-gray-50">
              <td class="py-2 px-4">{{ empleado.nombre }}</td>
              <td class="py-2 px-4">{{ empleado.apellido }}</td>
              <td class="py-2 px-4">{{ empleado.salario }}</td>
              <td class="py-2 px-4">{{ empleado.email }}</td>
              <td class="py-2 px-4">{{ empleado.id_puesto.titulo_puesto }}</td>
              <td class="py-2 px-4">
                {{ empleado.id_departamento.nombre_departamento }}
              </td>
              <td class="py-2 px-4 text-center space-x-2">
                <button
                  onclick="openModal('modal-update-{{ empleado.id }}')"
                  class="bg-yellow-400 hover:bg-yellow-500 text-white px-2 py-1 rounded"
                >
                  Editar
                </button>
                <button
                  onclick="openModal('modal-delete-{{ empleado.id }}')"
                  class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded"
                >
                  Eliminar
                </button>
              </td>
            </tr>

            <!-- Modal de editar -->
            <div
              id="modal-update-{{ empleado.id }}"
              class="fixed inset-0 bg-black bg-opacity-40 hidden justify-center items-center z-50"
            >
              <div class="bg-white p-6 rounded-lg w-full max-w-md">
                <h2 class="text-xl font-semibold mb-4">Editar Empleado</h2>
                <form
                  action="{% url 'empleados_update' pk=empleado.id_empleado %}"
                  method="POST"
                >
                  {% csrf_token %}

                  <input
                    type="hidden"
                    name="id_empleado"
                    value="{{ empleado.id_empleado }}"
                  />
                  <input
                    type="text"
                    name="nombre"
                    value="{{ empleado.nombre }}"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
                    required
                  />
                  <input
                    type="text"
                    name="apellido"
                    value="{{ empleado.apellido }}"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
                    required
                  />
                  <input
                    type="number"
                    name="salario"
                    value="{{ empleado.salario }}"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
                    required
                  />
                  <input
                    type="text"
                    name="email"
                    value="{{ empleado.email }}"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
                    required
                  />

                  <select
                    name="id_puesto"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-4"
                  >
                    <option value="">
                      {{ empleado.id_puesto.titulo_puesto }}
                    </option>
                    {% for puesto in puestos %}
                    <option value="{{ puesto.id_puesto }}"
                      {% if empleado.id_puesto.id_puesto == puesto.id_puesto %}selected{% endif %}>
                      {{ puesto.titulo_puesto }}
                    </option>
                    {% endfor %}
                  </select>

                  <select
                    name="id_departamento"
                    class="w-full border border-gray-300 rounded px-3 py-2 mb-4"
                    required
                  >
                    <option value="">
                      {{ empleado.id_departamento.nombre_departamento }}
                    </option>
                    {% for departamento in departamentos %}
                    <option value="{{ departamento.id_departamento }}">
                      {{ departamento.nombre_departamento }}
                    </option>
                    {% endfor %}
                  </select>

                  <div class="flex justify-end gap-2">
                    <button
                      type="button"
                      onclick="closeModal('modal-update-{{ empleado.id }}')"
                      class="px-4 py-2 rounded bg-gray-300"
                    >
                      Cancelar
                    </button>
                    <button
                      type="submit"
                      class="px-4 py-2 rounded bg-blue-600 text-white"
                    >
                      Guardar
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Modal de eliminar -->
            <div
              id="modal-delete-{{ empleado.id }}"
              class="fixed inset-0 bg-black bg-opacity-40 hidden justify-center items-center z-50"
            >
              <div class="bg-white p-6 rounded-lg w-full max-w-md">
                <h2 class="text-xl font-semibold mb-4">¿Eliminar empleado?</h2>
                <p>
                  ¿Estás seguro de que deseas eliminar a
                  <strong>{{ empleado.nombre }}</strong>?
                </p>
                <div class="flex justify-end mt-6 gap-2">
                  <button
                    onclick="closeModal('modal-delete-{{ empleado.id }}')"
                    class="px-4 py-2 rounded bg-gray-300"
                  >
                    Cancelar
                  </button>
                  <form
                    action="{% url 'empleados_delete' empleado.id_empleado %}"
                    method="POST"
                  >
                    {% csrf_token %}
                    <button
                      type="submit"
                      class="px-4 py-2 rounded bg-red-600 text-white"
                    >
                      Eliminar
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal de crear -->
    <div
      id="modal-create"
      class="fixed inset-0 bg-black bg-opacity-40 hidden justify-center items-center z-50"
    >
      <div class="bg-white p-6 rounded-lg w-full max-w-md">
        <h2 class="text-xl font-semibold mb-4">Crear nuevo empleado</h2>
        <form
          id="form-crear-empleado"
          method="POST"
          action="{% url 'crear_empleado' %}"
        >
          <!-- Aqui estan todos los inputst del formulario-->
          {% csrf_token %}
          <input
            type="text"
            name="id_empleado"
            placeholder="ID Empleado"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
            required
          />
          <input
            type="text"
            name="nombre"
            placeholder="Nombre"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
            required
          />
          <input
            type="text"
            name="apellido"
            placeholder="Apellido"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
            required
          />
          <input
            type="number"
            name="salario"
            placeholder="Salario"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
            required
          />
          <input
            type="text"
            name="email"
            placeholder="Email"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-2"
            required
          />

          <select
            name="id_puesto"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-4"
            required
          >
            <option value="">Selecciona un puesto</option>
            {% for puesto in puestos %}
            <option value="{{ puesto.id_puesto }}">
              {{ puesto.titulo_puesto }}
            </option>
            {% endfor %}
          </select>

          <select
            name="id_departamento"
            class="w-full border border-gray-300 rounded px-3 py-2 mb-4"
            required
          >
            <option value="">Selecciona un departamento</option>
            {% for departamento in departamentos %}
            <option value="{{ departamento.id_departamento }}">
              {{ departamento.nombre_departamento }}
            </option>
            {% endfor %}
          </select>

          <div class="flex justify-end gap-2">
            <button
              type="button"
              onclick="closeModal('modal-create')"
              class="px-4 py-2 rounded bg-gray-300"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="px-4 py-2 rounded bg-blue-600 text-white"
            >
              Crear
            </button>
          </div>
        </form>
      </div>
    </div>
    {% endblock %} {% if error_id %}
    <div
      id="modal-error-id"
      class="fixed inset-0 bg-black bg-opacity-40 flex justify-center items-center z-50"
    >
      <div class="bg-white p-6 rounded-lg w-full max-w-md text-center">
        <h2 class="text-xl font-semibold mb-4 text-red-600">¡Error!</h2>
        <p class="mb-6">{{ error_id }}</p>
        <button
          type="button"
          onclick="closeModal('modal-error-id')"
          class="px-4 py-2 rounded bg-blue-600 text-white"
        >
          Cerrar
        </button>
      </div>
    </div>
    {% endif %}

    <script>
      function openModal(id) {
        document.getElementById(id).classList.remove("hidden");
        document.getElementById(id).classList.add("flex");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("flex");
        document.getElementById(id).classList.add("hidden");
      }

      //navbar
      const navbar = document.getElementById("simpleNavbar");
      let lastScrollTop = 0;

      window.addEventListener("scroll", () => {
        const currentScroll = window.scrollY;

        if (currentScroll > lastScrollTop && currentScroll > 70) {
          // Oculta la navbar al bajar
          navbar.classList.add("-translate-y-full");
        } else {
          // Muestra la navbar al subir
          navbar.classList.remove("-translate-y-full");
        }

        lastScrollTop = currentScroll;
      });

      // Mostrar el modal de error automáticamente si existe
      window.onload = function() {
        var errorModal = document.getElementById('modal-error-id');
        if (errorModal) {
          errorModal.classList.remove('hidden');
          errorModal.classList.add('flex');
        }
      }
    </script>
  </body>
</html>
